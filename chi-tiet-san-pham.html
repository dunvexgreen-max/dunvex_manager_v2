<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chi Tiết Sản Phẩm | Dunvex Digital</title>
	<link rel="icon" type="image/svg+xml"
		href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle' fill='white' font-size='60' font-family='sans-serif' font-weight='800'>DV</text></svg>">
	<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
	<style>
		:root {
			--primary: #6366f1;
			--bg-dark: #0f172a;
			--card-bg: rgba(30, 41, 59, 0.7);
			--glass-border: rgba(255, 255, 255, 0.1);
			--text-main: #f8fafc;
			--text-muted: #94a3b8;
			--accent-purple: #c084fc;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Outfit', sans-serif;
		}

		body {
			background-color: var(--bg-dark);
			color: var(--text-main);
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			text-rendering: optimizeLegibility;
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 20px;
		}

		.detail-card {
			background: var(--card-bg);
			backdrop-filter: blur(30px);
			border: 1px solid var(--glass-border);
			border-radius: 32px;
			width: 100%;
			max-width: 850px;
			display: grid;
			grid-template-columns: 1fr 1.2fr;
			overflow: hidden;
			box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
			animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
		}

		@keyframes slideUp {
			from {
				opacity: 0;
				transform: translateY(40px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		@media (max-width: 768px) {
			.detail-card {
				grid-template-columns: 1fr;
			}
		}

		.product-image-side {
			background: rgba(0, 0, 0, 0.2);
			padding: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
		}

		.product-image-side img {
			width: 100%;
			height: auto;
			max-height: 400px;
			object-fit: contain;
			border-radius: 20px;
			filter: drop-shadow(0 15px 30px rgba(0, 0, 0, 0.3));
		}

		.product-content-side {
			padding: 50px;
			display: flex;
			flex-direction: column;
		}

		.badge-cat {
			background: rgba(99, 102, 241, 0.15);
			color: var(--primary);
			padding: 6px 16px;
			border-radius: 99px;
			font-size: 0.75rem;
			font-weight: 800;
			text-transform: uppercase;
			letter-spacing: 1px;
			width: fit-content;
			margin-bottom: 20px;
		}

		h1 {
			font-size: 2.5rem;
			font-weight: 800;
			margin-bottom: 5px;
			line-height: 1.2;
		}

		.product-sku {
			color: var(--text-muted);
			font-size: 0.9rem;
			margin-bottom: 25px;
		}

		.price-tag {
			font-size: 2rem;
			font-weight: 800;
			color: var(--primary);
			margin-bottom: 30px;
		}

		.specs-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
			margin-bottom: 40px;
		}

		.spec-item {
			display: flex;
			flex-direction: column;
			gap: 4px;
		}

		.spec-label {
			font-size: 0.7rem;
			color: var(--text-muted);
			text-transform: uppercase;
			letter-spacing: 1px;
		}

		.spec-value {
			font-weight: 600;
			font-size: 0.95rem;
		}

		.tabs {
			margin-top: auto;
			border-top: 1px solid var(--glass-border);
			padding-top: 30px;
		}

		.tabs-header {
			display: flex;
			gap: 30px;
			margin-bottom: 15px;
		}

		.tab-btn {
			background: none;
			border: none;
			color: var(--text-muted);
			font-weight: 600;
			cursor: pointer;
			padding-bottom: 8px;
			position: relative;
			transition: 0.3s;
		}

		.tab-btn.active {
			color: white;
		}

		.tab-btn.active::after {
			content: '';
			position: absolute;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 2px;
			background: var(--primary);
		}

		.tab-content {
			display: none;
			font-size: 0.9rem;
			color: var(--text-muted);
			line-height: 1.6;
		}

		.tab-content.active {
			display: block;
			animation: fadeIn 0.4s ease;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
			}

			to {
				opacity: 1;
			}
		}

		#errorMsg {
			text-align: center;
			padding: 40px;
			display: none;
		}
	</style>
</head>

<body>

	<div id="errorMsg">
		<h2>Sản phẩm không tồn tại hoặc đã bị xóa.</h2>
	</div>

	<div class="detail-card" id="content">
		<div class="product-image-side">
			<img src="" id="pImg" alt="Sản phẩm">
		</div>
		<div class="product-content-side">
			<div class="badge-cat" id="pCat">ĐANG TẢI...</div>
			<h1 id="pName">Tên sản phẩm</h1>
			<div class="product-sku" id="pId">Mã sản phẩm: --</div>

			<div class="price-tag" id="pPrice">0 đ</div>
			<div class="specs-grid">
				<div class="spec-item">
					<span class="spec-label">Quy cách</span>
					<span class="spec-value" id="pSpec">--</span>
				</div>
				<div class="spec-item">
					<span class="spec-label">Đóng kiện</span>
					<span class="spec-value" id="pPack">--</span>
				</div>
				<div class="spec-item">
					<span class="spec-label">Trọng lượng riêng</span>
					<span class="spec-value" id="pWeight">--</span>
				</div>
			</div>

			<div class="tabs">
				<div class="tabs-header">
					<button class="tab-btn active" onclick="switchTab(0)">Mô tả</button>
					<button class="tab-btn" onclick="switchTab(1)">Thông số</button>
				</div>
				<div class="tab-content active" id="tab0">
					Sản phẩm chất lượng cao, độ bền tốt, phù hợp cho các công trình xây dựng hiện đại. Thiết kế tối ưu
					cho việc lắp đặt nhanh chóng và bền bỉ dưới mọi thời tiết.
				</div>
				<div class="tab-content" id="tab1">
					Đang tải thông số chi tiết...
				</div>
			</div>
		</div>
	</div>

	<script>
		// Hàm chuyển đổi link Google Drive để hiển thị ảnh
		function convertDriveLink(url) {
			if (!url) return '';
			if (url.includes('drive.google.com')) {
				const id = url.split('/d/')[1]?.split('/')[0] || url.split('id=')[1]?.split('&')[0];
				return id ? `https://lh3.googleusercontent.com/d/${id}` : url;
			}
			return url;
		}

		function getParam(name) {
			return new URLSearchParams(window.location.search).get(name);
		}

		function switchTab(idx) {
			document.querySelectorAll('.tab-btn').forEach((b, i) => {
				b.classList.toggle('active', i === idx);
			});
			document.querySelectorAll('.tab-content').forEach((c, i) => {
				c.classList.toggle('active', i === idx);
			});
		}

		function formatPrice(val) {
			const n = parseFloat(val);
			return isNaN(n) ? '0' : n.toLocaleString('vi-VN');
		}

		function init() {
			const idFromUrl = getParam('id');
			const idFromStore = localStorage.getItem('last_selected_product_id');
			const id = idFromUrl || idFromStore;

			const all = JSON.parse(localStorage.getItem('last_loaded_products') || '[]');
			const p = all.find(x => String(x.id_san_pham) === String(id));

			if (!p) {
				document.getElementById('errorMsg').style.display = 'block';
				document.getElementById('content').style.display = 'none';
				return;
			}

			// Cập nhật thông tin văn bản
			document.getElementById('pName').innerText = p.ten_san_pham || 'Không có tên';
			document.getElementById('pId').innerText = "Mã sản phẩm: " + (p.id_san_pham || '--');
			document.getElementById('pCat').innerText = p.ten_nghanh_hang || 'Sản phẩm';
			document.getElementById('pPrice').innerText = formatPrice(p.gia_san_pham) + ' đ';
			document.getElementById('pSpec').innerText = p.quy_cach || 'Tiêu chuẩn';
			document.getElementById('pPack').innerText = p.dong_kien ? p.dong_kien + " tấm/kiện" : '--';
			document.getElementById('pWeight').innerText = p.trong_luong_rieng ? p.trong_luong_rieng + " kg" : '--';

			// Xử lý hình ảnh
			const finalImgUrl = convertDriveLink(p.image_san_pham);
			document.getElementById('pImg').src = finalImgUrl || 'https://placehold.co/600x600/1e293b/white?text=No+Image';

			// Cập nhật tab kỹ thuật
			if (p.quy_cach || p.trong_luong_rieng) {
				let techInfo = `Thông số chi tiết: ${p.quy_cach || 'Tiêu chuẩn'}.`;
				if (p.trong_luong_rieng) techInfo += ` Trọng lượng riêng: ${p.trong_luong_rieng} kg/đơn vị.`;
				techInfo += ` Sản phẩm đạt chuẩn kiểm định xây dựng chất lượng cao.`;
				document.getElementById('tab1').innerText = techInfo;
			}
		}

		window.onload = init;
	</script>
	<script src="floating-menu.js"></script>
	<script src="chatbot.js"></script>
</body>

</html>