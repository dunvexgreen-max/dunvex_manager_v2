<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chi Tiết Sản Phẩm</title>
	<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
		rel="stylesheet">
	<style>
		:root {
			--primary: #FFD700;
			--dark: #121212;
			--dark-card: #1e1e1e;
			--text-light: #ffffff;
			--text-gray: #a0a0a0;
			--glass: rgba(255, 255, 255, 0.05);
			--glass-border: rgba(255, 255, 255, 0.1);
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Plus Jakarta Sans', sans-serif;
		}

		body {
			background-color: transparent;
			color: var(--text-light);
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			padding: 20px;
		}

		.detail-container {
			background: var(--dark-card);
			width: 100%;
			max-width: 900px;
			border-radius: 30px;
			border: 1px solid var(--glass-border);
			overflow: hidden;
			display: grid;
			grid-template-columns: 1fr 1fr;
			box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
			animation: slideUp 0.5s ease-out;
		}

		@keyframes slideUp {
			from {
				opacity: 0;
				transform: translateY(30px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.image-section {
			background: #1a1a1a;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 30px;
			position: relative;
		}

		.image-section img {
			max-width: 100%;
			max-height: 400px;
			border-radius: 20px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
			object-fit: contain;
		}

		.info-section {
			padding: 40px;
			display: flex;
			flex-direction: column;
		}

		.badge {
			display: inline-block;
			background: var(--primary);
			color: var(--dark);
			padding: 6px 14px;
			border-radius: 20px;
			font-size: 0.75rem;
			font-weight: 800;
			text-transform: uppercase;
			margin-bottom: 20px;
			align-self: flex-start;
		}

		h1 {
			font-size: 2rem;
			font-weight: 800;
			margin-bottom: 10px;
			line-height: 1.2;
		}

		.product-id {
			color: var(--text-gray);
			font-size: 0.9rem;
			margin-bottom: 25px;
			display: block;
		}

		.price-label {
			font-size: 0.85rem;
			color: var(--text-gray);
			margin-bottom: 5px;
		}

		.price-value {
			font-size: 2.5rem;
			font-weight: 800;
			color: var(--primary);
			margin-bottom: 30px;
		}

		.specs {
			border-top: 1px solid var(--glass-border);
			padding-top: 25px;
			margin-top: auto;
		}

		.spec-item {
			display: flex;
			justify-content: space-between;
			margin-bottom: 15px;
			font-size: 0.95rem;
		}

		.spec-label {
			color: var(--text-gray);
		}

		.spec-value {
			font-weight: 600;
		}

		.btn-close {
			display: none;
			/* Only show if needed or handle by parent */
		}

		/* Mobile Responsive */
		@media (max-width: 768px) {
			.detail-container {
				grid-template-columns: 1fr;
			}

			.image-section {
				padding: 20px;
			}

			.info-section {
				padding: 30px 20px;
			}
		}

		#loading {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: var(--dark);
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			z-index: 100;
		}

		.spinner {
			width: 40px;
			height: 40px;
			border: 3px solid var(--glass-border);
			border-top: 3px solid var(--primary);
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin-bottom: 15px;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}
	</style>
</head>

<body>
	<div id="loading">
		<div class="spinner"></div>
		<p>Đang tải thông tin...</p>
	</div>

	<div class="detail-container" id="detailContainer" style="display: none;">
		<div class="image-section">
			<img id="productImg" src="" alt="Sản phẩm">
		</div>
		<div class="info-section">
			<span class="badge" id="productBadge">Danh mục</span>
			<h1 id="productName">Tên sản phẩm</h1>
			<span class="product-id" id="productId">Mã SP: ...</span>

			<div class="price-box">
				<p class="price-label">Giá bán niêm yết</p>
				<p class="price-value" id="productPrice">0 đ</p>
			</div>

			<div class="specs">
				<div class="spec-item">
					<span class="spec-label">Quy cách</span>
					<span class="spec-value" id="productSpecUnit">...</span>
				</div>
				<div class="spec-item">
					<span class="spec-label">Đóng kiện</span>
					<span class="spec-value" id="productSpecPacking">...</span>
				</div>
				<div class="spec-item">
					<span class="spec-label">Trạng thái</span>
					<span class="spec-value" style="color: #00c853;">Sẵn hàng</span>
				</div>
			</div>
		</div>
	</div>

	<script>
		const PLACEHOLDER_IMG = "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22400%22%20height%3D%22300%22%20viewBox%3D%220%200%20400%20300%22%3E%3Crect%20width%3D%22400%22%20height%3D%22300%22%20fill%3D%22%232c2c2c%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20dominant-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20font-family%3D%22sans-serif%22%20font-size%3D%2220%22%20fill%3D%22%23555%22%3ENo%20Image%3C%2Ftext%3E%3C%2Fsvg%3E";

		document.addEventListener('DOMContentLoaded', () => {
			const params = new URLSearchParams(window.location.search);
			let productId = params.get('id');

			// Dự phòng: Nếu URL không có ID, thử lấy từ localStorage
			if (!productId) {
				productId = localStorage.getItem('last_selected_product_id');
			}

			if (productId && productId.trim() !== "") {
				productId = productId.trim();
				const userStr = localStorage.getItem('userLoggedIn');
				if (!userStr) {
					showError("Vui lòng đăng nhập");
					return;
				}

				// Lấy dữ liệu từ localStorage
				const productsData = localStorage.getItem('last_loaded_products');
				if (productsData) {
					const products = JSON.parse(productsData);
					const p = products.find(x => String(x.id_san_pham || x.idsanpham || '').trim() === String(productId));
					if (p) {
						renderDetail(p);
						return;
					}
				}

				showError("Không tìm thấy thông tin sản phẩm có ID: " + productId);
			} else {
				showError("Mã sản phẩm bị trống hoặc không hợp lệ. (Đã phát hiện: " + (productId || "Trống") + ")");
			}
		});

		function renderDetail(p) {
			const name = p.ten_san_pham || p.tensanpham || 'Sản phẩm chưa đặt tên';
			const category = p.ten_nghanh_hang || p.tennganhhang || 'Chưa phân loại';
			const price = parseFloat(p.gia_san_pham || p.giasanpham) || 0;
			const id = p.id_san_pham || p.idsanpham;
			let imgUrl = (p.image_san_pham || p.imagesanpham || '').trim();
			if (!imgUrl) imgUrl = PLACEHOLDER_IMG;

			document.getElementById('productName').innerText = name;
			document.getElementById('productBadge').innerText = category;
			document.getElementById('productId').innerText = `Mã SP: ${id}`;
			document.getElementById('productPrice').innerText = formatCurrency(price);
			document.getElementById('productImg').src = imgUrl;
			document.getElementById('productSpecUnit').innerText = p.quy_cach || p.quycach || '-';
			document.getElementById('productSpecPacking').innerText = p.dong_kien || p.dongkien || '-';

			document.getElementById('loading').style.display = 'none';
			document.getElementById('detailContainer').style.display = 'grid';
		}

		function showError(msg) {
			const loading = document.getElementById('loading');
			loading.innerHTML = `<p style="color: #ff3d00; font-weight: 700;">${msg}</p>`;
		}

		function formatCurrency(val) {
			return new Intl.NumberFormat('vi-VN').format(val) + ' đ';
		}
	</script>
</body>

</html>