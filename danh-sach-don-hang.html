<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Danh S√°ch ƒê∆°n H√†ng | Dunvex Digital</title>
	<link rel="icon" type="image/svg+xml"
		href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle' fill='white' font-size='60' font-family='sans-serif' font-weight='800'>DV</text></svg>">
	<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
	<style>
		:root {
			--primary: #6366f1;
			--bg-dark: #0f172a;
			--card-bg: rgba(30, 41, 59, 0.7);
			--glass-border: rgba(255, 255, 255, 0.1);
			--text-main: #f8fafc;
			--text-muted: #94a3b8;
			--accent-purple: #c084fc;
			--success: #22c55e;
			--danger: #ef4444;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Outfit', sans-serif;
		}

		body {
			background-color: var(--bg-dark);
			color: var(--text-main);
			min-height: 100vh;
			background-image: radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(192, 132, 252, 0.15) 0px, transparent 50%);
			padding: 20px;
		}

		.container {
			max-width: 1200px;
			margin: 20px auto;
		}

		.header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}

		.header h1 {
			font-size: 1.8rem;
			font-weight: 800;
			background: linear-gradient(135deg, #fff, var(--primary));
			-webkit-background-clip: text;
			background-clip: text;
			-webkit-text-fill-color: transparent;
		}

		/* Tabs */
		.tabs-nav {
			display: flex;
			gap: 10px;
			margin-bottom: 25px;
			background: rgba(0, 0, 0, 0.2);
			padding: 5px;
			border-radius: 12px;
			width: fit-content;
		}

		.tab-btn {
			padding: 10px 24px;
			border-radius: 8px;
			border: none;
			background: transparent;
			color: var(--text-muted);
			font-weight: 600;
			cursor: pointer;
			transition: 0.3s;
		}

		.tab-btn.active {
			background: var(--primary);
			color: white;
			box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
		}

		.content-section {
			display: none;
		}

		.content-section.active {
			display: block;
			animation: fadeIn 0.4s ease-out;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		/* Dashboard Styles */
		.db-grid {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 20px;
			margin-bottom: 30px;
		}

		.db-card {
			background: var(--card-bg);
			border: 1px solid var(--glass-border);
			border-radius: 20px;
			padding: 20px;
			backdrop-filter: blur(10px);
		}

		.db-val {
			font-size: 1.5rem;
			font-weight: 800;
			margin-top: 5px;
			color: var(--primary);
		}

		.db-label {
			font-size: 0.85rem;
			color: var(--text-muted);
			font-weight: 500;
		}

		.chart-row {
			display: grid;
			grid-template-columns: 2fr 1fr;
			gap: 20px;
			margin-bottom: 25px;
		}

		.full-row {
			grid-template-columns: 1fr !important;
		}

		.chart-card {
			background: var(--card-bg);
			border: 1px solid var(--glass-border);
			border-radius: 20px;
			padding: 25px;
			height: 400px;
		}

		.chart-title {
			font-size: 1.1rem;
			font-weight: 600;
			margin-bottom: 20px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		/* Order List Specifics */
		.filters {
			display: flex;
			gap: 15px;
			margin-bottom: 25px;
		}

		.search-box {
			flex: 1;
		}

		input,
		select {
			width: 100%;
			padding: 12px 16px;
			background: rgba(0, 0, 0, 0.2);
			border: 1px solid var(--glass-border);
			border-radius: 12px;
			color: white;
			outline: none;
		}

		.order-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
			gap: 20px;
		}

		.order-card {
			background: var(--card-bg);
			backdrop-filter: blur(20px);
			border: 1px solid var(--glass-border);
			border-radius: 20px;
			padding: 20px;
			transition: 0.3s;
		}

		.order-card:hover {
			transform: translateY(-5px);
			border-color: var(--primary);
		}

		.order-header {
			display: flex;
			justify-content: space-between;
			margin-bottom: 15px;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
			padding-bottom: 10px;
		}

		.order-id {
			font-weight: 800;
			color: var(--primary);
		}

		.order-date {
			font-size: 0.8rem;
			color: var(--text-muted);
		}

		.cust-name {
			font-size: 1.1rem;
			font-weight: 600;
			margin-bottom: 10px;
		}

		.order-info {
			font-size: 0.9rem;
			color: var(--text-muted);
			margin-bottom: 5px;
		}

		.order-total {
			font-size: 1.2rem;
			font-weight: 800;
			color: var(--success);
			margin-top: 15px;
			text-align: right;
		}

		.status-badge {
			padding: 4px 10px;
			border-radius: 20px;
			font-size: 0.7rem;
			font-weight: 700;
			text-transform: uppercase;
		}

		.status-paid {
			background: rgba(34, 197, 94, 0.2);
			color: #22c55e;
		}

		.status-pending {
			background: rgba(192, 132, 252, 0.2);
			color: var(--accent-purple);
		}

		.btn {
			padding: 8px 16px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			transition: 0.3s;
			border: none;
			font-size: 0.85rem;
		}

		.btn-view {
			background: rgba(99, 102, 241, 0.1);
			color: var(--primary);
			border: 1px solid var(--primary);
		}

		.btn-delete {
			background: rgba(239, 68, 68, 0.1);
			color: var(--danger);
			border: 1px solid var(--danger);
		}

		#toast {
			position: fixed;
			top: 20px;
			right: 20px;
			padding: 16px 24px;
			border-radius: 12px;
			background: var(--success);
			color: white;
			font-weight: 600;
			transform: translateX(200%);
			transition: 0.4s;
			z-index: 3000;
		}

		#toast.active {
			transform: translateX(0);
		}

		.back-btn {
			text-decoration: none;
			color: var(--text-muted);
			font-size: 0.9rem;
		}

		/* Modal Styles */
		.modal {
			display: none;
			position: fixed;
			inset: 0;
			background: rgba(15, 23, 42, 0.9);
			backdrop-filter: blur(10px);
			z-index: 4000;
			padding: 40px;
			justify-content: center;
			align-items: center;
		}

		.modal.active {
			display: flex;
		}

		.modal-content {
			width: 100%;
			max-width: 1100px;
			height: 90vh;
			background: white;
			border-radius: 20px;
			position: relative;
			overflow: hidden;
		}

		.close-modal {
			position: absolute;
			top: 20px;
			right: 20px;
			width: 44px;
			height: 44px;
			background: white;
			border: 1px solid #ddd;
			border-radius: 50%;
			font-size: 24px;
			cursor: pointer;
			z-index: 5000;
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
		}

		iframe#printFrame {
			width: 100%;
			height: 100%;
			border: none;
		}

		.top-list {
			list-style: none;
		}

		.top-item {
			display: flex;
			justify-content: space-between;
			padding: 12px 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
		}

		.top-name {
			font-weight: 500;
			font-size: 0.95rem;
		}

		.top-val {
			font-weight: 700;
			color: var(--success);
		}

		/* Dashboard Stat Filters */
		.db-filters {
			display: flex;
			gap: 10px;
			margin-bottom: 20px;
			flex-wrap: wrap;
		}

		.db-filter-chip {
			padding: 8px 16px;
			border-radius: 20px;
			background: rgba(255, 255, 255, 0.05);
			border: 1px solid var(--glass-border);
			color: var(--text-muted);
			font-size: 0.8rem;
			font-weight: 600;
			cursor: pointer;
			transition: 0.3s;
		}

		.db-filter-chip:hover {
			background: rgba(255, 255, 255, 0.1);
		}

		.db-filter-chip.active {
			background: var(--primary);
			color: white;
			border-color: var(--primary);
			box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
		}

		@media (max-width: 800px) {
			body {
				padding: 10px;
			}

			.container {
				margin: 10px auto;
				padding: 5px;
			}

			.header {
				flex-direction: column;
				align-items: flex-start;
				gap: 15px;
			}

			.header h1 {
				font-size: 1.4rem;
			}

			.header div {
				width: 100%;
				justify-content: space-between;
			}

			.db-grid {
				grid-template-columns: 1fr;
				gap: 12px;
			}

			.db-card {
				padding: 15px;
			}

			.db-val {
				font-size: 1.3rem;
			}

			.chart-row {
				grid-template-columns: 1fr;
				gap: 15px;
			}

			.chart-card {
				height: 350px;
				padding: 15px;
			}

			.db-filters {
				overflow-x: auto;
				padding: 5px 0;
				gap: 8px;
				justify-content: flex-start;
				mask-image: linear-gradient(to right, black 90%, transparent 100%);
				-webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
			}

			.db-filter-chip {
				flex: 0 0 auto;
				padding: 6px 14px;
				font-size: 0.75rem;
			}

			.tabs-nav {
				width: 100%;
			}

			.tab-btn {
				flex: 1;
				padding: 10px;
				font-size: 0.85rem;
			}

			.filters {
				flex-direction: column;
				gap: 10px;
			}

			#statusFilter {
				width: 100% !important;
			}

			.order-grid {
				grid-template-columns: 1fr;
			}

			.chart-title {
				font-size: 0.95rem;
				flex-direction: column;
				align-items: flex-start;
				gap: 10px;
			}

			.chart-title div {
				width: 100%;
				display: flex;
				gap: 5px !important;
			}

			.chart-title input {
				flex: 1;
				font-size: 0.75rem !important;
			}
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

	<div id="toast">Th√¥ng b√°o!</div>

	<div class="container">
		<div class="header">
			<h1>üìã Qu·∫£n L√Ω ƒê∆°n H√†ng</h1>
			<div style="display: flex; gap: 15px; align-items: center;">
				<a href="len-don-hang.html" class="btn btn-view" style="background: var(--primary); color: white;">+ ƒê∆†N
					M·ªöI</a>
				<a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>
			</div>
		</div>

		<div class="tabs-nav">
			<button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
			<button class="tab-btn" onclick="switchTab('list')">üìã Danh s√°ch</button>
		</div>

		<!-- SECTION: DASHBOARD -->
		<div id="section-dashboard" class="content-section active">
			<div class="db-filters">
				<button class="db-filter-chip active" onclick="filterDashboard('all')">T·∫•t c·∫£ ƒë∆°n</button>
				<button class="db-filter-chip" onclick="filterDashboard('ƒê∆°n ch·ªët')">ƒê∆°n ch·ªët</button>
				<button class="db-filter-chip" onclick="filterDashboard('ƒêang x·ª≠ l√Ω')">ƒêang x·ª≠ l√Ω</button>
				<button class="db-filter-chip" onclick="filterDashboard('Ho√†n th√†nh')">Ho√†n th√†nh</button>
				<button class="db-filter-chip" onclick="filterDashboard('ƒê√£ h·ªßy')">ƒê√£ h·ªßy</button>
			</div>

			<div class="db-grid">
				<div class="db-card">
					<div class="db-label">T·ªïng doanh thu</div>
					<div id="db-total-rev" class="db-val">0 ƒë</div>
				</div>
				<div class="db-card">
					<div class="db-label">S·ªë l∆∞·ª£ng ƒë∆°n</div>
					<div id="db-total-qty" class="db-val">0</div>
				</div>
				<div class="db-card">
					<div class="db-label">L·ª£i nhu·∫≠n (T·∫°p t√≠nh)</div>
					<div id="db-profit" class="db-val">0 ƒë</div>
				</div>
				<div class="db-card">
					<div class="db-label">S·ªë kh√°ch h√†ng</div>
					<div id="db-total-cust" class="db-val">0</div>
				</div>
			</div>

			<div class="chart-row">
				<div class="chart-card">
					<div class="chart-title">üìà Doanh thu theo th√°ng</div>
					<canvas id="monthlyChart"></canvas>
				</div>
				<div class="chart-card" style="overflow-y: auto;">
					<div class="chart-title">üèÜ S·∫£n ph·∫©m Top</div>
					<div id="topProductsList" class="top-list"></div>
				</div>
			</div>

			<div class="chart-row full-row">
				<div class="chart-card" style="height: auto; min-height: 450px;">
					<div class="chart-title">
						<span>üë• Doanh thu theo kh√°ch h√†ng</span>
						<div style="display: flex; gap: 10px;">
							<input type="date" id="custDateStart" style="width: 150px; font-size: 0.8rem; padding: 6px;"
								onchange="updateCustomerStats()">
							<input type="date" id="custDateEnd" style="width: 150px; font-size: 0.8rem; padding: 6px;"
								onchange="updateCustomerStats()">
						</div>
					</div>
					<div id="customerRevenueStats" class="top-list">
						<!-- Dynamic table/list -->
					</div>
				</div>
			</div>
		</div>

		<!-- SECTION: LIST -->
		<div id="section-list" class="content-section">
			<div class="filters">
				<div class="search-box">
					<input type="text" id="searchInput" placeholder="T√¨m t√™n kh√°ch h√†ng ho·∫∑c m√£ ƒë∆°n..."
						oninput="filterOrders()">
				</div>
				<select id="statusFilter" style="width: 200px;" onchange="filterOrders()">
					<option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
					<option value="ƒê∆°n ch·ªët">ƒê∆°n ch·ªët</option>
					<option value="ƒêang x·ª≠ l√Ω">ƒêang x·ª≠ l√Ω</option>
					<option value="Ho√†n th√†nh">Ho√†n th√†nh</option>
					<option value="ƒê√£ h·ªßy">ƒê√£ h·ªßy</option>
				</select>
			</div>

			<div id="loader" style="text-align: center; padding: 50px; font-size: 1.2rem; color: var(--text-muted);">üöÄ
				ƒêang t·∫£i ƒë∆°n h√†ng...</div>
			<div id="orderGrid" class="order-grid"></div>
		</div>
	</div>

	<!-- Modal In Phi·∫øu -->
	<div id="printModal" class="modal">
		<div class="modal-content">
			<button class="close-modal" onclick="closeModal()">√ó</button>
			<iframe src="" id="printFrame"></iframe>
		</div>
	</div>

	<script>
		const ORDER_URL = 'https://script.google.com/macros/s/AKfycby_Uduzhl4k6aVfQEcgRr7XV3Vz-xJSIHIuQ4sD50I8Y0662wEHcWHgQMGJ2IaRgeNL5w/exec';
		let currentUser = JSON.parse(localStorage.getItem('user'));
		if (!currentUser) window.location.href = 'auth.html';

		let allOrders = [];
		let allDetails = [];
		let charts = {};
		let currentDbStatus = 'all';

		async function loadOrders() {
			try {
				const res = await fetch(ORDER_URL, {
					method: 'POST',
					body: JSON.stringify({
						action: 'get_orders',
						userEmail: currentUser.email,
						isAdmin: currentUser.roleId === 'R001'
					})
				});
				const data = await res.json();
				if (data.success) {
					allOrders = data.orders;
					allDetails = data.details || [];
					renderOrders(allOrders);
					initDashboard();
				}
			} catch (e) { showToast("L·ªói t·∫£i ƒë∆°n h√†ng", true); }
			document.getElementById('loader').style.display = 'none';
		}

		function switchTab(tab) {
			document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
			document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));

			event.target.classList.add('active');
			document.getElementById(`section-${tab}`).classList.add('active');
		}

		// --- DASHBOARD LOGIC ---
		function parseVNData(dateStr) {
			try {
				const [time, date] = dateStr.split(' ');
				const [d, m, y] = date.split('/');
				return new Date(`${y}-${m}-${d}T${time}`);
			} catch (e) { return new Date(); }
		}

		function filterDashboard(status) {
			currentDbStatus = status;
			document.querySelectorAll('.db-filter-chip').forEach(c => {
				c.classList.toggle('active', c.innerText.includes(status === 'all' ? 'T·∫•t c·∫£' : status));
			});
			initDashboard();
		}

		function getFilteredOrdersForDb() {
			if (currentDbStatus === 'all') return allOrders;
			return allOrders.filter(o => o.trang_thai_don_hang === currentDbStatus);
		}

		function initDashboard() {
			const activeOrders = getFilteredOrdersForDb();
			if (!activeOrders.length) {
				// Reset displays if no data
				document.getElementById('db-total-rev').innerText = '0 ƒë';
				document.getElementById('db-total-qty').innerText = '0';
				document.getElementById('db-total-cust').innerText = '0';
				document.getElementById('db-profit').innerText = '0 ƒë';
				renderMonthlyChart(activeOrders);
				renderTopProducts(activeOrders);
				updateCustomerStats(activeOrders);
				return;
			}

			// 1. Overview
			const totalRev = activeOrders.reduce((acc, o) => acc + (parseInt(o.so_tien_con_lai) || 0), 0);
			const totalCust = [...new Set(activeOrders.map(o => o.ten_khach_hang))].length;

			document.getElementById('db-total-rev').innerText = formatCurrency(totalRev);
			document.getElementById('db-total-qty').innerText = activeOrders.length;
			document.getElementById('db-total-cust').innerText = totalCust;
			document.getElementById('db-profit').innerText = formatCurrency(totalRev * 0.15); // Mock profit 15%

			// 2. Monthly Chart
			renderMonthlyChart(activeOrders);

			// 3. Top Products
			renderTopProducts(activeOrders);

			// 4. Customer Revenue
			updateCustomerStats(activeOrders);
		}

		function renderMonthlyChart(activeOrders) {
			const monthsData = {};
			activeOrders.forEach(o => {
				const date = parseVNData(o.ngay_len_don);
				const monthKey = `${date.getMonth() + 1}/${date.getFullYear()}`;
				monthsData[monthKey] = (monthsData[monthKey] || 0) + (parseInt(o.so_tien_con_lai) || 0);
			});

			const labels = Object.keys(monthsData).reverse();
			const values = labels.map(label => monthsData[label]);

			const ctx = document.getElementById('monthlyChart').getContext('2d');
			if (charts.monthly) charts.monthly.destroy();

			charts.monthly = new Chart(ctx, {
				type: 'line',
				data: {
					labels: labels,
					datasets: [{
						label: 'Doanh thu',
						data: values,
						borderColor: '#6366f1',
						backgroundColor: 'rgba(99, 102, 241, 0.1)',
						fill: true,
						tension: 0.4,
						borderWidth: 3,
						pointRadius: 5
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: { legend: { display: false } },
					scales: {
						y: {
							beginAtZero: true,
							grid: { color: 'rgba(255,255,255,0.05)' },
							ticks: { color: '#94a3b8' }
						},
						x: {
							grid: { display: false },
							ticks: { color: '#94a3b8' }
						}
					}
				}
			});
		}

		function renderTopProducts(activeOrders) {
			const activeIds = new Set(activeOrders.map(o => o.id_don_hang));
			const prods = {};

			allDetails.forEach(d => {
				if (activeIds.has(d.id_don_hang)) {
					const name = d.ten_san_pham;
					prods[name] = (prods[name] || 0) + (parseFloat(d.so_luong) || 0);
				}
			});

			const sorted = Object.entries(prods)
				.sort((a, b) => b[1] - a[1])
				.slice(0, 8);

			const list = document.getElementById('topProductsList');
			if (!sorted.length) {
				list.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding-top: 20px;">Ch∆∞a c√≥ d·ªØ li·ªáu s·∫£n ph·∫©m</div>';
				return;
			}
			list.innerHTML = sorted.map(([name, qty]) => `
				<div class="top-item">
					<span class="top-name">${name}</span>
					<span class="top-val">${qty} sp</span>
				</div>
			`).join('');
		}

		function updateCustomerStats(activeOrders) {
			const start = document.getElementById('custDateStart').value;
			const end = document.getElementById('custDateEnd').value;

			let filtered = activeOrders || getFilteredOrdersForDb();
			if (start) filtered = filtered.filter(o => parseVNData(o.ngay_len_don) >= new Date(start));
			if (end) filtered = filtered.filter(o => parseVNData(o.ngay_len_don) <= new Date(end));

			const custMap = {};
			filtered.forEach(o => {
				const name = o.ten_khach_hang || "Kh√°ch l·∫°";
				if (!custMap[name]) custMap[name] = { name: name, total: 0, count: 0 };
				custMap[name].total += (parseInt(o.so_tien_con_lai) || 0);
				custMap[name].count++;
			});

			const sortedCust = Object.values(custMap).sort((a, b) => b.total - a.total);

			const container = document.getElementById('customerRevenueStats');
			container.innerHTML = `
				<div style="display: grid; grid-template-columns: 2fr 1fr 1fr; padding-bottom: 10px; font-weight: 800; border-bottom: 1px solid var(--primary);">
					<span>T√™n kh√°ch h√†ng</span>
					<span>S·ªë ƒë∆°n</span>
					<span style="text-align: right;">Doanh thu</span>
				</div>
			` + sortedCust.map(c => `
				<div class="top-item" style="grid-template-columns: 2fr 1fr 1fr; display: grid;">
					<span class="top-name">${c.name}</span>
					<span class="top-val" style="color: var(--accent-purple)">${c.count} ƒë∆°n</span>
					<span class="top-val" style="text-align: right;">${formatCurrency(c.total)}</span>
				</div>
			`).join('');
		}

		// --- LIST LOGIC ---
		function renderOrders(orders) {
			const grid = document.getElementById('orderGrid');
			grid.innerHTML = orders.map(o => `
                <div class="order-card">
                    <div class="order-header">
                        <span class="order-id">${o.id_don_hang}</span>
                        <span class="order-date">${o.ngay_len_don}</span>
                    </div>
                    <div class="cust-name">${o.ten_khach_hang}</div>
                    <div class="order-info">üë§ Ng∆∞·ªùi t·∫°o: ${o.nguoi_len_don.split('@')[0]}</div>
                    <div class="order-info">üìù Ghi ch√∫: ${o.ghi_chu_don_hang || '-'}</div>
                    <div style="margin-top: 10px;">
                        <span class="status-badge ${o.trang_thai_don_hang === 'Ho√†n th√†nh' ? 'status-paid' : 'status-pending'}">${o.trang_thai_don_hang}</span>
                    </div>
                    <div class="order-total">${formatCurrency(o.so_tien_con_lai)}</div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-view" style="flex: 1" onclick="editOrder('${o.id_don_hang}')">S·ª¨A</button>
                        <button class="btn btn-view" style="flex: 1" onclick="printSlip('${o.id_don_hang}')">IN PHI·∫æU</button>
                        <button class="btn btn-delete" onclick="deleteOrder('${o.id_don_hang}')">X√ìA</button>
                    </div>
                </div>
            `).join('');
		}

		function filterOrders() {
			const q = document.getElementById('searchInput').value.toLowerCase();
			const status = document.getElementById('statusFilter').value;
			const filtered = allOrders.filter(o =>
				(o.ten_khach_hang.toLowerCase().includes(q) || o.id_don_hang.toLowerCase().includes(q)) &&
				(status === "" || o.trang_thai_don_hang === status)
			);
			renderOrders(filtered);
		}

		async function deleteOrder(id) {
			if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng " + id + "?")) return;
			try {
				const res = await fetch(ORDER_URL, {
					method: 'POST',
					body: JSON.stringify({ action: 'delete_order', order_id: id })
				});
				const data = await res.json();
				if (data.success) {
					showToast("ƒê√£ x√≥a ƒë∆°n h√†ng");
					loadOrders();
				}
			} catch (e) { showToast("L·ªói khi x√≥a", true); }
		}

		function editOrder(id) {
			localStorage.setItem('edit_order_id', id);
			window.location.href = `sua-don-hang.html?id=${id}`;
		}

		function printSlip(id) {
			localStorage.setItem('print_order_id', id);
			const modal = document.getElementById('printModal');
			document.getElementById('printFrame').src = `phieu-giao-hang.html?id=${encodeURIComponent(id)}`;
			modal.classList.add('active');
			document.body.style.overflow = 'hidden';
		}

		function closeModal() {
			document.getElementById('printModal').classList.remove('active');
			document.getElementById('printFrame').src = '';
			document.body.style.overflow = 'auto';
		}

		function formatCurrency(val) { return new Intl.NumberFormat('vi-VN').format(val) + ' ƒë'; }
		function showToast(msg, isError = false) {
			const t = document.getElementById('toast');
			t.innerText = msg;
			t.style.background = isError ? 'var(--danger)' : 'var(--success)';
			t.classList.add('active');
			setTimeout(() => t.classList.remove('active'), 3000);
		}

		window.onload = loadOrders;
	</script>
	<script src="chatbot.js"></script>
<script src="floating-menu.js"></script>
</body>

</html>


</html>