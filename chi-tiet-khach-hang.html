<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chi Tiết Khách Hàng - Premium View</title>
	<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
		rel="stylesheet">
	<style>
		:root {
			--primary: #FFD700;
			--primary-soft: rgba(255, 215, 0, 0.1);
			--dark: #0f0f0f;
			--dark-card: #1a1a1a;
			--text-light: #ffffff;
			--text-gray: #a0a0a0;
			--glass: rgba(255, 255, 255, 0.03);
			--glass-border: rgba(255, 255, 255, 0.1);
			--success: #00e676;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Plus Jakarta Sans', sans-serif;
		}

		body {
			background-color: var(--dark);
			color: var(--text-light);
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 20px;
		}

		.detail-card {
			width: 100%;
			max-width: 600px;
			background: var(--dark-card);
			border-radius: 32px;
			border: 1px solid var(--glass-border);
			overflow: hidden;
			box-shadow: 0 40px 100px rgba(0, 0, 0, 0.6);
			animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
		}

		@keyframes slideUp {
			from {
				opacity: 0;
				transform: translateY(40px) scale(0.95);
			}

			to {
				opacity: 1;
				transform: translateY(0) scale(1);
			}
		}

		.header-section {
			background: linear-gradient(135deg, #222, #111);
			padding: 40px;
			text-align: center;
			position: relative;
			border-bottom: 1px solid var(--glass-border);
		}

		.avatar-circle {
			width: 100px;
			height: 100px;
			background: var(--primary);
			color: var(--dark);
			border-radius: 50%;
			font-size: 2.5rem;
			font-weight: 800;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto 20px;
			box-shadow: 0 15px 35px rgba(255, 215, 0, 0.3);
			border: 4px solid var(--dark-card);
		}

		.customer-name {
			font-size: 1.8rem;
			font-weight: 800;
			background: linear-gradient(to right, #fff, var(--primary));
			-webkit-background-clip: text;
			background-clip: text;
			-webkit-text-fill-color: transparent;
			margin-bottom: 5px;
		}

		.customer-id-badge {
			display: inline-block;
			padding: 4px 12px;
			background: var(--primary-soft);
			color: var(--primary);
			border-radius: 20px;
			font-size: 0.85rem;
			font-weight: 700;
			letter-spacing: 1px;
		}

		.content-section {
			padding: 40px;
		}

		.info-grid {
			display: grid;
			grid-template-columns: 1fr;
			gap: 25px;
		}

		.info-item {
			display: flex;
			align-items: flex-start;
			gap: 15px;
		}

		.icon-box {
			width: 44px;
			height: 44px;
			background: var(--glass);
			border-radius: 14px;
			display: flex;
			align-items: center;
			justify-content: center;
			color: var(--primary);
			flex-shrink: 0;
			border: 1px solid var(--glass-border);
		}

		.info-content label {
			display: block;
			font-size: 0.75rem;
			text-transform: uppercase;
			color: var(--text-gray);
			letter-spacing: 1px;
			margin-bottom: 4px;
			font-weight: 600;
		}

		.info-content p {
			font-size: 1.05rem;
			font-weight: 500;
			line-height: 1.5;
		}

		.actions-section {
			padding: 0 40px 40px;
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 15px;
		}

		.btn {
			padding: 16px;
			border-radius: 18px;
			font-weight: 700;
			text-align: center;
			text-decoration: none;
			transition: all 0.3s;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
			font-size: 0.95rem;
			border: none;
		}

		.btn-primary {
			background: var(--primary);
			color: var(--dark);
			box-shadow: 0 10px 20px rgba(255, 215, 0, 0.2);
		}

		.btn-primary:hover {
			transform: translateY(-3px);
			box-shadow: 0 15px 30px rgba(255, 215, 0, 0.3);
		}

		.btn-glass {
			background: var(--glass);
			color: var(--text-light);
			border: 1px solid var(--glass-border);
		}

		.btn-glass:hover {
			background: rgba(255, 255, 255, 0.08);
			transform: translateY(-2px);
		}

		.btn-maps {
			grid-column: span 2;
			background: var(--success);
			color: var(--dark);
			margin-bottom: 10px;
		}

		.btn-maps:hover {
			background: #00c853;
			transform: scale(1.02);
		}

		/* Loader */
		#loader {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: var(--dark);
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			z-index: 100;
		}

		.spinner {
			width: 50px;
			height: 50px;
			border: 4px solid var(--glass);
			border-top: 4px solid var(--primary);
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin-bottom: 20px;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}

		@media (max-width: 480px) {
			.detail-card {
				border-radius: 0;
				height: 100vh;
				max-width: none;
			}

			body {
				padding: 0;
			}

			.actions-section {
				grid-template-columns: 1fr;
			}

			.btn-maps {
				grid-column: span 1;
			}
		}
	</style>
</head>

<body>
	<div id="loader">
		<div class="spinner"></div>
		<p style="font-weight: 700; letter-spacing: 1px;">ĐANG TẢI THÔNG TIN...</p>
	</div>

	<div class="detail-card" id="detailCard" style="display: none;">
		<div class="header-section">
			<div class="avatar-circle" id="avatarText">K</div>
			<div id="customerName" class="customer-name">Khách Hàng</div>
			<div class="customer-id-badge" id="customerId">ID: ---</div>
		</div>

		<div class="content-section">
			<div class="info-grid">
				<div class="info-item">
					<div class="icon-box">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
							stroke-width="2.5">
							<path
								d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
							</path>
						</svg>
					</div>
					<div class="info-content">
						<label>Điện Thoại</label>
						<p id="customerPhone">---</p>
					</div>
				</div>

				<div class="info-item">
					<div class="icon-box">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
							stroke-width="2.5">
							<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
							<circle cx="12" cy="10" r="3"></circle>
						</svg>
					</div>
					<div class="info-content">
						<label>Địa Chỉ</label>
						<p id="customerAddress">---</p>
					</div>
				</div>

				<div class="info-item">
					<div class="icon-box">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
							stroke-width="2.5">
							<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
							<line x1="16" y1="2" x2="16" y2="6"></line>
							<line x1="8" y1="2" x2="8" y2="6"></line>
							<line x1="3" y1="10" x2="21" y2="10"></line>
						</svg>
					</div>
					<div class="info-content">
						<label>Ngày Tạo</label>
						<p id="customerDate">---</p>
					</div>
				</div>

				<div class="info-item" id="gpsRow" style="display: none;">
					<div class="icon-box">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
							stroke-width="2.5">
							<polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
						</svg>
					</div>
					<div class="info-content">
						<label>Tọa Độ GPS</label>
						<p id="customerGPS">---</p>
					</div>
				</div>
			</div>
		</div>

		<div class="actions-section">
			<a href="#" id="mapsLink" target="_blank" class="btn btn-maps" style="display: none;">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
					<path d="M1 6v16l7-4 8 4 7-4V2l-7 4-8-4-7 4z"></path>
					<line x1="8" y1="2" x2="8" y2="18"></line>
					<line x1="16" y1="6" x2="16" y2="22"></line>
				</svg>
				XEM VỊ TRÍ TRÊN BẢN ĐỒ
			</a>
			<a href="danh-sach-khach-hang.html" class="btn btn-glass">QUAY LẠI</a>
			<a href="#" id="editLink" class="btn btn-primary">CHỈNH SỬA</a>
		</div>
	</div>

	<script>
		const KHACH_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxJ_SMcR1BOrVrZ9Ym0pmhuAa4XbP0ASvYPM5LhQxZLenCLvWy-Nc0jBiv3finAByac/exec';

		document.addEventListener('DOMContentLoaded', async () => {
			const userStr = localStorage.getItem('userLoggedIn');
			if (!userStr) {
				window.location.href = 'index.html';
				return;
			}
			const userData = JSON.parse(userStr);

			const params = new URLSearchParams(window.location.search);
			const id = params.get('id');

			if (!id) {
				alert("Không tìm thấy mã khách hàng!");
				window.location.href = 'danh-sach-khach-hang.html';
				return;
			}

			try {
				const url = `${KHACH_SCRIPT_URL}?action=read&username=${encodeURIComponent(userData.email)}`;
				const res = await fetch(url);
				const result = await res.json();

				if (result.success) {
					const customer = result.data.find(c => {
						// Tìm ID linh hoạt
						let currentId = c.idkhachhang || c.id_khach_hang || c.makh || c['Mã khách hàng'] || "";
						return String(currentId).trim() === id.trim();
					});

					if (customer) {
						renderCustomer(customer);
					} else {
						alert("Sản phẩm không tồn tại hoặc bạn không có quyền xem!");
						window.location.href = 'danh-sach-khach-hang.html';
					}
				}
			} catch (err) {
				console.error(err);
				alert("Lỗi kết nối dữ liệu!");
			} finally {
				document.getElementById('loader').style.display = 'none';
			}
		});

		function renderCustomer(c) {
			const id = c.idkhachhang || c.id_khach_hang || c.makh || c['Mã khách hàng'] || "";
			const ten = c.tenkhachhang || c.ten_khach_hang || c['Tên khách hàng'] || "Chưa có tên";
			const phone = c.phone || c.sodienthoai || c.sdt || c['Số điện thoại'] || "Chưa có SĐT";
			const diachi = c.diachi || c.dia_chi || "Chưa có địa chỉ";
			const vitri = c.vitri || c.vi_tri || "";
			const ngaytao = c.ngaytao || c.ngay_tao || "---";

			document.getElementById('customerName').innerText = ten;
			document.getElementById('avatarText').innerText = ten.charAt(0).toUpperCase();
			document.getElementById('customerId').innerText = `ID: ${id}`;
			document.getElementById('customerPhone').innerText = phone;
			document.getElementById('customerAddress').innerText = diachi;
			document.getElementById('customerDate').innerText = ngaytao;

			if (vitri) {
				document.getElementById('gpsRow').style.display = 'flex';
				document.getElementById('customerGPS').innerText = vitri;
				const mapsBtn = document.getElementById('mapsLink');
				mapsBtn.style.display = 'flex';
				mapsBtn.href = `https://www.google.com/maps?q=${encodeURIComponent(vitri)}`;
			}

			document.getElementById('editLink').href = `khach-hang-edit?id=${encodeURIComponent(id)}`;
			document.getElementById('detailCard').style.display = 'block';
		}
	</script>
</body>

</html>