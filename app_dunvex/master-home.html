<!DOCTYPE html>
<html lang="vi">

<head>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ2HMYTDH"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-QFQ2HMYTDH');
	</script>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Master Dashboard | Dunvex Digital</title>
	<link rel="icon" type="image/svg+xml"
		href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle' fill='white' font-size='60' font-family='sans-serif' font-weight='800'>DV</text></svg>">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Outfit:wght@600;800&display=swap" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<style>
		:root {
			--primary: #818cf8;
			--primary-dark: #6366f1;
			--secondary: #c084fc;
			--success: #22c55e;
			--danger: #ef4444;
			--warning: #f59e0b;
			--bg: #0f172a;
			--card-bg: rgba(30, 41, 59, 0.7);
			--border: rgba(255, 255, 255, 0.1);
			--text: #ffffff;
			--text-muted: #cbd5e1;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
			text-rendering: optimizeLegibility;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

		body {
			background: var(--bg);
			color: var(--text);
			min-height: 100vh;
			overflow-x: hidden;
			background-image:
				radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 40%),
				radial-gradient(circle at 90% 80%, rgba(192, 132, 252, 0.1) 0%, transparent 40%);
			-webkit-text-size-adjust: 100%;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
			padding: 40px 20px;
		}

		header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 40px;
		}

		.logo-area h1 {
			font-size: 2rem;
			font-weight: 800;
			background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
			background-clip: text;
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			letter-spacing: -1px;
		}

		.logo-area p {
			color: var(--text-muted);
			font-size: 0.9rem;
		}

		.user-profile {
			display: flex;
			align-items: center;
			gap: 15px;
			background: var(--card-bg);
			padding: 8px 16px;
			border-radius: 50px;
			border: 1px solid var(--border);
			backdrop-filter: blur(10px);
		}

		.avatar {
			width: 35px;
			height: 35px;
			background: var(--primary);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: bold;
			font-size: 1rem;
		}

		/* Stats Grid */
		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}

		.stat-card {
			background: var(--card-bg);
			border: 1px solid var(--border);
			padding: 24px;
			border-radius: 24px;
			backdrop-filter: blur(10px);
			transition: transform 0.3s ease, border-color 0.3s ease;
			position: relative;
			overflow: hidden;
		}

		.stat-card:hover {
			transform: translateY(-5px);
			border-color: rgba(255, 255, 255, 0.2);
		}

		.stat-card i {
			font-size: 1.5rem;
			margin-bottom: 15px;
			display: block;
			color: var(--primary);
		}

		.stat-card .label {
			color: var(--text-muted);
			font-size: 0.85rem;
			text-transform: uppercase;
			letter-spacing: 1px;
			margin-bottom: 5px;
		}

		.stat-card .value {
			font-size: 1.8rem;
			font-weight: 800;
		}

		/* Dashboard Main Layout */
		.main-layout {
			display: grid;
			grid-template-columns: 2fr 1fr;
			gap: 25px;
		}

		.card {
			background: var(--card-bg);
			border: 1px solid var(--border);
			border-radius: 30px;
			padding: 30px;
			backdrop-filter: blur(15px);
		}

		.card-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 25px;
		}

		.card-title {
			font-size: 1.2rem;
			font-weight: 600;
		}

		.chart-container {
			height: 300px;
		}

		/* Activity Logs */
		.log-list {
			list-style: none;
		}

		.log-item {
			display: flex;
			gap: 15px;
			padding: 15px 0;
			border-bottom: 1px solid var(--border);
		}

		.log-item:last-child {
			border-bottom: none;
		}

		.log-icon {
			width: 40px;
			height: 40px;
			border-radius: 12px;
			background: rgba(99, 102, 241, 0.1);
			display: flex;
			align-items: center;
			justify-content: center;
			color: var(--primary);
			flex-shrink: 0;
		}

		.log-content {
			font-size: 0.9rem;
		}

		.log-time {
			font-size: 0.75rem;
			color: var(--text-muted);
			margin-top: 4px;
		}

		/* Quick Actions */
		.quick-actions {
			display: grid;
			grid-template-columns: 1fr;
			gap: 15px;
			margin-top: 25px;
		}

		.action-btn {
			display: flex;
			align-items: center;
			justify-content: space-between;
			background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.01) 100%);
			border: 1px solid var(--border);
			padding: 18px 24px;
			border-radius: 20px;
			text-decoration: none;
			color: var(--text);
			font-weight: 600;
			transition: all 0.3s ease;
		}

		.action-btn:hover {
			background: var(--primary);
			border-color: var(--primary-dark);
			box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
		}

		/* Loading Overlay */
		#loader {
			position: fixed;
			inset: 0;
			background: var(--bg);
			z-index: 9999;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.pulse {
			width: 80px;
			height: 80px;
			background: var(--primary);
			border-radius: 50%;
			animation: pulse 1.5s infinite ease-in-out;
		}

		@keyframes pulse {
			0% {
				transform: scale(0.8);
				opacity: 0.5;
			}

			50% {
				transform: scale(1.2);
				opacity: 0;
			}

			100% {
				transform: scale(0.8);
				opacity: 0.5;
			}
		}

		@media (max-width: 1024px) {
			.main-layout {
				grid-template-columns: 1fr;
			}
		}

		@media (max-width: 768px) {
			.container {
				padding: 20px 15px;
			}

			header {
				flex-direction: column;
				gap: 20px;
				text-align: center;
			}

			.logo-area h1 {
				font-size: 1.5rem;
			}

			.user-profile {
				width: 100%;
				justify-content: center;
			}

			.stats-grid {
				grid-template-columns: 1fr 1fr;
				gap: 12px;
			}

			.stat-card {
				padding: 16px;
			}

			.stat-card .value {
				font-size: 1.2rem;
			}

			.card {
				padding: 20px 15px;
				border-radius: 20px;
			}

			.chart-container {
				height: 250px;
			}

			.action-btn {
				padding: 15px;
				font-size: 0.9rem;
			}
		}

		@media (max-width: 480px) {
			.stats-grid {
				grid-template-columns: 1fr;
			}
		}
	</style>
</head>

<body>
	<div id="loader">
		<div class="pulse"></div>
	</div>

	<div class="container">
		<header>
			<div class="logo-area">
				<h1>MASTER HUB</h1>
				<p>Welcome back, Super Admin</p>
			</div>
			<div class="user-profile">
				<div class="avatar" id="avatarLetter">D</div>
				<div style="font-size: 0.9rem; font-weight: 600;" id="adminName">Super Admin</div>
				<button onclick="logout()"
					style="background:transparent; border:none; color:var(--danger); cursor:pointer; margin-left:10px;">
					<i class="fas fa-sign-out-alt"></i>
				</button>
			</div>
		</header>

		<div class="stats-grid">
			<div class="stat-card">
				<i class="fas fa-users-gear" style="color: var(--primary);"></i>
				<div class="label">T·ªïng Users H·ªá Th·ªëng</div>
				<div class="value" id="stat-users">0</div>
				<div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px;" id="stat-sub-users">Admin: 0
					| Staff: 0</div>
			</div>
			<div class="stat-card">
				<i class="fas fa-chart-line" style="color: var(--success);"></i>
				<div class="label">Doanh Thu H√¥m Nay</div>
				<div class="value" id="stat-revenue-today">0 ‚Ç´</div>
			</div>
			<div class="stat-card">
				<i class="fas fa-wallet" style="color: var(--secondary);"></i>
				<div class="label">Doanh Thu Th√°ng N√†y</div>
				<div class="value" id="stat-revenue-month">0 ‚Ç´</div>
			</div>
			<div class="stat-card">
				<i class="fas fa-briefcase" style="color: var(--warning);"></i>
				<div class="label">Kh√°ch H√†ng To√†n H·ªá Th·ªëng</div>
				<div class="value" id="stat-customers">0</div>
			</div>
		</div>

		<div class="main-layout">
			<div class="card">
				<div class="card-header">
					<div class="card-title">TƒÉng Tr∆∞·ªüng Doanh Thu (7 ng√†y g·∫ßn nh·∫•t)</div>
					<i class="fas fa-ellipsis-h" style="color: var(--text-muted); cursor: pointer;"></i>
				</div>
				<div class="chart-container">
					<canvas id="revenueChart"></canvas>
				</div>
			</div>

			<div class="card">
				<div class="card-header">
					<div class="card-title">Ho·∫°t ƒê·ªông H·ªá Th·ªëng</div>
				</div>
				<ul class="log-list" id="activityList">
					<!-- Logs injection -->
				</ul>
				<div class="quick-actions">
					<a href="super-admin.html" class="action-btn">
						<span>üõ°Ô∏è V√†o Master Control</span>
						<i class="fas fa-chevron-right"></i>
					</a>
					<a href="admin-checkin-summary.html" class="action-btn">
						<span>üìç Theo d√µi Check-in</span>
						<i class="fas fa-chevron-right"></i>
					</a>
				</div>
			</div>
		</div>
	</div>

	<!-- Floating Menu script handle separately if needed -->
	<script src="floating-menu.js"></script>

	<script>
		const MASTER_API = 'https://script.google.com/macros/s/AKfycbz2FpV9hWeZKzBJyS636Hlf7JrM8bfA03YbH9xF3KYqdHJXcpgvCLoD2xjOGCDKzpfj/exec';
		let chart = null;

		window.onload = async () => {
			const user = JSON.parse(localStorage.getItem('user'));
			if (!user || user.email !== 'dunvex.green@gmail.com') {
				window.location.href = 'auth.html';
				return;
			}

			document.getElementById('adminName').innerText = user.fullName;
			document.getElementById('avatarLetter').innerText = user.fullName.charAt(0).toUpperCase();

			await loadDashboardData();
			document.getElementById('loader').style.display = 'none';
		};

		async function loadDashboardData() {
			try {
				const res = await fetch(MASTER_API, {
					method: 'POST',
					body: JSON.stringify({ action: 'getMasterDashboardData' })
				});
				const data = await res.json();
				if (data.success) {
					updateUI(data);
				}
			} catch (e) {
				console.error("Master Load error", e);
			}
		}

		function updateUI(data) {
			const { stats, chartData, recentLogs } = data;

			// Update Stats
			document.getElementById('stat-users').innerText = stats.totalUsers;
			document.getElementById('stat-sub-users').innerText = `Admin: ${stats.totalAdmins} | Staff: ${stats.totalStaff}`;
			document.getElementById('stat-revenue-today').innerText = stats.todayRevenue.toLocaleString() + ' ‚Ç´';
			document.getElementById('stat-revenue-month').innerText = stats.monthRevenue.toLocaleString() + ' ‚Ç´';
			document.getElementById('stat-customers').innerText = stats.totalCustomers;

			// Update Logs
			const logTbody = document.getElementById('activityList');
			if (recentLogs && recentLogs.length > 0) {
				logTbody.innerHTML = recentLogs.map(l => `
                    <li class="log-item">
                        <div class="log-icon"><i class="fas fa-receipt"></i></div>
                        <div class="log-content">
                            <div>${l.content}</div>
                            <div class="log-time">${new Date(l.time).toLocaleTimeString('vi-VN')} - ${new Date(l.time).toLocaleDateString('vi-VN')}</div>
                        </div>
                    </li>
                `).join('');
			} else {
				logTbody.innerHTML = '<li style="color:var(--text-muted); text-align:center; padding:20px;">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o h√¥m nay.</li>';
			}

			// Render Chart
			renderChart(chartData);
		}

		function renderChart(chartData) {
			const ctx = document.getElementById('revenueChart').getContext('2d');
			const labels = chartData.map(d => {
				const parts = d.date.split('-');
				return `${parts[2]}/${parts[1]}`;
			});
			const values = chartData.map(d => d.revenue);

			if (chart) chart.destroy();

			chart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: labels,
					datasets: [{
						label: 'Doanh Thu (‚Ç´)',
						data: values,
						borderColor: '#818cf8',
						background: 'linear-gradient(180deg, rgba(129, 140, 248, 0.2) 0%, transparent 100%)',
						backgroundColor: (context) => {
							const chart = context.chart;
							const { ctx, chartArea } = chart;
							if (!chartArea) return null;
							const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
							gradient.addColorStop(0, 'rgba(129, 140, 248, 0)');
							gradient.addColorStop(1, 'rgba(129, 140, 248, 0.2)');
							return gradient;
						},
						fill: true,
						tension: 0.4,
						borderWidth: 3,
						pointBackgroundColor: '#fff',
						pointHoverRadius: 6,
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { display: false }
					},
					scales: {
						y: {
							beginAtZero: true,
							grid: { color: 'rgba(255,255,255,0.05)' },
							ticks: { color: '#94a3b8', font: { size: 10 } }
						},
						x: {
							grid: { display: false },
							ticks: { color: '#94a3b8', font: { size: 10 } }
						}
					}
				}
			});
		}

		function logout() {
			if (confirm("X√°c nh·∫≠n ƒëƒÉng xu·∫•t?")) {
				localStorage.clear();
				window.location.href = 'auth.html';
			}
		}
	</script>
</body>

</html>